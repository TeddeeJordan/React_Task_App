"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.lazy = void 0;
const tslib_1 = require("tslib");
const namespaced_1 = require("./namespaced");
const utils_1 = require("../utils");
function lazy(configurations) {
    let app;
    return {
        onInitialize(_, value) {
            app = value;
        },
        effects: {
            lazy: {
                loadConfig(config) {
                    return app.actions.lazy.loadConfig(config);
                },
            },
        },
        actions: {
            lazy: {
                loadConfig(_a, key) {
                    var { state, execution } = _a, rest = tslib_1.__rest(_a, ["state", "execution"]);
                    const configToLoad = configurations[key];
                    const namespacePath = execution.namespacePath.slice(0, execution.namespacePath.length - 1).concat(key);
                    return configToLoad().then((loadedConfig) => {
                        const newConfig = namespaced_1.namespaced({
                            [key]: loadedConfig,
                        });
                        if (newConfig.state && newConfig.state[key])
                            state[key] = utils_1.processState(newConfig.state[key]);
                        if (newConfig.effects && newConfig.effects[key])
                            app.effects[key] = newConfig.effects[key];
                        if (newConfig.actions && newConfig.actions[key])
                            app.actions[key] = app.getActions(newConfig.actions[key], namespacePath);
                        if (newConfig.onInitialize)
                            newConfig.onInitialize(Object.assign({ state, execution: Object.assign(Object.assign({}, execution), { namespacePath }) }, rest), app);
                    });
                },
            },
        },
    };
}
exports.lazy = lazy;
//# sourceMappingURL=lazy.js.map